define(["directives/directives"],function(e){e.directive("directUserSetting",["$compile","deploydService","$cookies","authServices","$rootScope",function(e,t,n,r,i){function s(e,s,o){$(s).ready(function(){function o(){s.find("#inputOldPassword").val(""),s.find("#inputNewPassword").val(""),s.find("#inputPasswordConfirm").val(""),s.find(".help-block").html("")}function u(){s.find("#radGender label").removeClass("active"),s.find("#radFaculty label").removeClass("active"),s.find(".setting-help-block").html("")}function a(e){var t=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)}i.$on("userSetting",function(r){$("#overlay").show(),s.find("#loading-indicator").show(),e.thisUser=undefined,t.GetCurrentUser({Cookie:n.get("dCookie")},function(t){t!=undefined&&t.status=="active"&&(e.thisUser=angular.copy(t),s.find("#my_setting_Modal").find("#radGender input[value='"+e.thisUser.gender+"']").parent().addClass("active"),s.find("#my_setting_Modal").find("#radFaculty input[value='"+e.thisUser.faculty+"']").parent().addClass("active")),$("#overlay").hide(),s.find("#loading-indicator").hide()})}),s.find("#my_settingPW_Modal .submit").on("click",function(e){var n=$(this);n.addClass("disabled");var i=s.find("#inputOldPassword").val(),o=s.find("#inputNewPassword").val(),u=s.find("#inputPasswordConfirm").val();i==""||o==""||u==""?(s.find(".help-block").html("Password cannot be blank").css("color","red"),n.removeClass("disabled")):o.length<6||u.length<6?(s.find(".help-block").html("Password must be at least 6 character").css("color","red"),n.removeClass("disabled")):r.GetCurrentUser(function(e){var r="";e!=undefined&&e.status=="active"&&(r=angular.copy(e),t.UserLogin({username:r.username,password:i},function(e){n.removeClass("disabled");if(e.id==undefined)s.find(".help-block").html("Incorrect Old Password").css("color","red");else if(o!=u)s.find(".help-block").html("New Password unmatch Confirm Password").css("color","red");else{s.find(".help-block").html("");var i={id:r.id,password:u};t.UpdateUser(i,function(e){alert("Password Changed Sucessful"),n.removeClass("disabled"),s.find("#my_settingPW_Modal").find(".cancel").click()})}}))})}),s.find("#my_setting_Modal .update").on("click",function(n){e.thisUser.gender=s.find("#radGender input:radio:checked").val(),e.thisUser.faculty=s.find("#radFaculty input:radio:checked").val();var r=s.find("#inputDisplayName").val(),o=s.find("#inputEmail").val(),u=!1,f="",l=$(this);l.addClass("disabled"),r==""||o==""||e.thisUser.gender==undefined||e.thisUser.faculty==undefined?(f="Field Cannot be blank",u=!0):r.length>15||r.length<5?(f="Invalid Displayname",u=!0):a(o)||(f="Invalid Email",u=!0);if(u)l.removeClass("disabled"),s.find(".setting-help-block").html(f).css("color","red");else{s.find(".setting-help-block").html("");var c={id:e.thisUser.id,displayname:r,email:o,gender:e.thisUser.gender,faculty:e.thisUser.faculty,loadimgbydefault:e.thisUser.loadimgbydefault};t.UpdateUser(c,function(e){alert("Update Sucessful"),l.removeClass("disabled"),s.find("#my_setting_Modal").find(".cancel").click(),i.$broadcast("deploydLoginDetailsChanged",{value:e.displayname})})}}),$("#my_settingPW_Modal").on("hidden.bs.modal",function(){$(this).data("bs.modal",null),o()}),$("#my_setting_Modal").on("hidden.bs.modal",function(){$(this).data("bs.modal",null),u()})})}return{restrict:"E",template:'<div><div class="modal fade" id="my_settingPW_Modal" role="dialog"><div class="modal-dialog"><!-- Modal content--><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Change Password</h4></div><form role="form"><div class="form-group"><label for="inputOldPassword" class="control-label">Old Password : </label><input type="password" data-minlength="6" maxlength="15" class="form-control" id="inputOldPassword"></div><div class="form-group"><label for="inputNewPassword" class="control-label">New Password : </label><input type="password" class="form-control" id="inputNewPassword" placeholder="Minimum of 6 characters"></div><div class="form-group"><label for="inputPasswordConfirm" class="control-label">Confirm Password : </label><input type="password" class="form-control" id="inputPasswordConfirm" placeholder="Minimum of 6 characters" ></div><div class="help-block with-errors"></div><div class="modal-footer  form-group"><button type="submit" class="btn btn-default submit">Change</button><button type="button" class="btn btn-default cancel" data-dismiss="modal">Close</button></form></div></div></div></div><div class="modal fade" id="my_setting_Modal" role="dialog"><div class="modal-dialog"><!-- Modal content--><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">User Setting</h4></div><form role="form" style="padding: 10px 10px 0px 10px;"><div class="form-group" ><label for="inputName" class="control-label">User Name : {{ thisUser.username }}</label></div><div class="form-group"><label for="inputName" class="control-label">Display Name</label><input type="text" class="form-control" ng-model="thisUser.displayname" ng-bind="thisUser.displayname" id="inputDisplayName" data-minlength="5" maxlength="15" placeholder="Display Name (Min 5, Max 15 words)."><div class="help-block with-errors"></div></div><div class="form-group"><label for="inputEmail" class="control-label">Email</label><input type="email" class="form-control" ng-model="thisUser.email" id="inputEmail" placeholder="Email" ><div class="help-block with-errors"></div></div><img src="img/loading.gif" id="loading-indicator" style="display:none" /><div class="form-group"><label for="gender" class="control-label">Gender : </label><div class="btn-group" id="radGender" data-toggle="buttons"><label class="btn btn-default blue"><input type="radio" class="radgender" name="radgender" ng-model="thisUser.gender" ng-bind="thisUser.gender"  value="male"/>Male</label><label class="btn btn-default blue"><input type="radio" class="radgender" name="radgender" ng-model="thisUser.gender" ng-bind="thisUser.gender" value="female"/> Female</label><label class="btn btn-default blue"><input type="radio" class="radgender" name="radgender" ng-model="thisUser.gender" ng-bind="thisUser.gender" value="unknown"/> Unknown</label></div><div class="help-block with-errors"></div></div><div class="form-group"><label for="faculty" class="control-label">Faculty : </label><div class="btn-group" id="radFaculty" data-toggle="buttons"><label class="btn btn-default blue"><input type="radio" name="faculty" ng-model="thisUser.faculty" ng-bind="thisUser.faculty" class="radfaculty" value="FASC"/>FASC</label><label class="btn btn-default blue"><input type="radio" name="faculty" ng-model="thisUser.faculty" ng-bind="thisUser.faculty" class="radfaculty" value="FAFB"/> FAFB</label><label class="btn btn-default blue"><input type="radio" name="faculty" ng-model="thisUser.faculty" ng-bind="thisUser.faculty" class="radfaculty" value="FEBE"/> FEBE</label><label class="btn btn-default blue"><input type="radio" name="faculty" ng-model="thisUser.faculty" ng-bind="thisUser.faculty" class="radfaculty" value="FSAH"/> FSAH</label><label class="btn btn-default blue"><input type="radio" name="faculty" ng-model="thisUser.faculty" ng-bind="thisUser.faculty" class="radfaculty" value="CPUS"/> CPUS</label></div><div class="setting-help-block with-errors"></div></div><div class="form-group"><input type="checkbox" ng-model="thisUser.loadimgbydefault" ng-bind="thisUser.loadimgbydefault"<label for="gender" class="control-label"> Show Picture on Post (Untick to reduce data usage) </label></div><div class="modal-footer  form-group"><button type="submit" class="btn btn-default update">Update</button><button type="button" class="btn btn-default cancel" data-dismiss="modal">Close</button></form></div></div></div></div></div>',link:s,replace:!0}}])});